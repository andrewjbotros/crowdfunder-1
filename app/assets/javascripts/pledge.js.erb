$(document).on('page:change', function() {

	if ($('.project-page').length) {
		var breakpoints = $('.breakpoint'),
				role = breakpoints.data('role');

		if (role === 'backer') {
			clickable(breakpoints, updatePledge)
		}
		else if (role === 'user') {
			clickable(breakpoints, createPledge);
		}
		else if (role === 'guest') {
			clickable(breakpoints, redirectToLogin);
		}

	}

	function clickable(breakpoints, actionToPerform) {
		breakpoints.click(function(event) {
			var _this = $(this);
			actionToPerform(_this);
		});
	}

	function createPledge(breakpoint) {
		$.ajax({
			url: '/pledges',
			type: 'POST',
			dataType: 'script',
			data: { pledge: { breakpoint_id: breakpoint.data('breakpointId') } }
		})
	}

	function updatePledge(breakpoint) {
		$.ajax({
			url: '/pledges/' + breakpoint.data('pledgeId'),
			type: 'PATCH',
			dataType: 'script',
			data: { pledge: { breakpoint_id: breakpoint.data('breakpointId') } }
		})
	}

	function redirectToLogin(breakpoint) {
		window.location.replace('/signin')
	}

});